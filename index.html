<!DOCTYPE html>
<html>
	<head>
		<title>PIWADIO</title>
		<meta charset="utf-8">
		<meta name="viewport" content="minimal-ui, width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, target-densitydpi=device-dpi" />
		<meta name="author" content="David Art [aka] adcomp" >
		<link rel="icon" type="image/png" href="static/favicon.png" />
		<link href="static/style.css" rel="stylesheet" />
		<script type="text/javascript" src="static/jquery.js"></script>
	</head>
<body>
	<header>
		<h1>PI<b>WADIO</b>  <small>[ Web Radio Player ]</small></h1>
		<h2><small>[ STATE ]</small> <span id="state">stop</span> </div>
		<h2><small>[ URL . ]</small> <span id="url"></span> </div>
	</header>

	<div class="main">
		<div id="playlist">loading playlist ...</div>
	</div><!-- main -->
	
	<footer class="footer">

		<div id="cmd">
			<button id="bt_voldown" class="bt_cmd" onclick="ws.send('volume -1');">Vol-</button>
			<button id="bt_voldown" class="bt_cmd" onclick="ws.send('volume 1');">Vol+</button>
			<button id="bt_stop" class="bt_cmd" onclick="ws.send('stop');">Stop</button>
			<button id="bt_pause" class="bt_cmd" onclick="ws.send('pause');">Pause</button>
		</div>
		
	</footer>
	
<script>
var ws = null;

var playlist = { 
	"Classic 21": "http://classic21.ice.rtbf.be/classic21-128.mp3.m3u",
	"RTBF La Première": "http://lapremiere.ice.rtbf.be/lapremiere-128.mp3.m3u",
	"Pure FM": "http://purefm.ice.rtbf.be/purefm-128.mp3.m3u",
	"RTBF VivaCité": "http://vivacitecharleroi.ice.rtbf.be/vivacharleroi-128.mp3.m3u",
	"Bel RTL": "http://www.listenlive.eu/belrtl.m3u",
	"Fun Radio": "http://broadcast.infomaniak.ch/funradiobe-high.mp3.m3u",
	"Mint": "http://www.listenlive.eu/mint.m3u",
	"Nostalgie": "http://nostalgiepremium.ice.infomaniak.ch/nostalgiepremium-128.mp3.m3u",
	"NRJ": "http://broadcast.infomaniak.net/nrjbe-high.mp3.m3u",
	"Radio Contact": "http://www.listenlive.eu/contactfr.m3u"
}

window.onload = init;

function init() {
	$('#bt_pause').hide();

	$.getJSON( "static/playlist.json", function( data ) {
	  var items = [];
	  $.each( data, function( key, val ) {
		html = '<div class="radio">';
		html += '<button class="bt_radio" onclick="ws.send(\'loadlist ' + val + '\');">';
		html += key;
		html += '</button></div>';
		items.push( html );
	  });
	 
	  $("#playlist").html(items.join( "" ));
	});
	
	connect();
}

function connect() {
	var url = window.location.href;
	var arr = url.split('/');
	var host = arr[2];
	ws = new WebSocket("ws://" + host + "/piwardio");

	ws.onmessage = function(evt) {
		console.log(evt.data);
		var data = JSON.parse(evt.data);
		
		$('#state').html(data.state);
		
		if (data.state == "stop") {
			$('#bt_pause').hide();
		}
		
		else if (data.state == "play" || data.state == "pause") {
			$('#bt_pause').show();
		}
		
		if (data.url) {
			$('#url').html(data.url);
		} else {
			$('#url').html('-');
		}
	};

	ws.onclose = function(evt) {
		console.log("Connection close ..");
	};

	ws.onopen = function(evt) {
		console.log("WebSocket open ..")
	};
}

</script>

</body>
</html>

